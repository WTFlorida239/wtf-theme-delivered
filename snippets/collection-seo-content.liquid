{%- comment -%}
  Collection SEO Content Block - ENHANCED
  
  Purpose: Add rich, keyword-optimized content to collection pages with collapsible UI
  
  Features:
  - Dynamic content per collection from metafields or defaults
  - Collapsible "About This Collection" block
  - Pulls from collection.metafields.seo.long_description
  - Auto-inserts top 3 products as internal links if no custom HTML
  - Local keywords (Cape Coral, Fort Myers, SWFL)
  - Visible at bottom of collection page (not hidden)
  
  Usage: {% render 'collection-seo-content', collection: collection %}
{%- endcomment -%}

{%- if collection -%}
<div class="collection-seo-content" id="collection-about">
  {%- liquid
    assign long_desc = collection.metafields.seo.long_description
    assign has_custom_content = false
    
    if long_desc != blank
      assign has_custom_content = true
    endif
  -%}
  
  <details class="collection-about-details" open>
    <summary class="collection-about-summary">
      <h2>About This Collection</h2>
      <span class="collection-about-toggle" aria-hidden="true">
        <svg class="icon-chevron" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </span>
    </summary>
    
    <div class="collection-about-content">
      {%- if has_custom_content -%}
        {%- comment -%} Use custom metafield content {%- endcomment -%}
        <div class="collection-custom-content">
          {{ long_desc }}
        </div>
      {%- else -%}
        {%- comment -%} Default CTA with top 3 products {%- endcomment -%}
        <div class="collection-default-content">
          <p>
            Explore our curated selection of <strong>{{ collection.title }}</strong> at WTF | Welcome To Florida, 
            Cape Coral's premier destination for premium botanical beverages and products. 
            Each item in this collection is carefully selected to provide you with the best quality and experience.
          </p>
          
          {%- if collection.products.size > 0 -%}
            <h3>Featured Products in {{ collection.title }}</h3>
            <ul class="collection-featured-products">
              {%- assign product_count = 0 -%}
              {%- for product in collection.products limit: 3 -%}
                {%- if product.available -%}
                  <li>
                    <a href="{{ product.url }}">
                      <strong>{{ product.title }}</strong>
                    </a>
                    {%- if product.metafields.seo.short_description -%}
                      — {{ product.metafields.seo.short_description }}
                    {%- elsif product.description != blank -%}
                      — {{ product.description | strip_html | truncate: 100 }}
                    {%- endif -%}
                  </li>
                  {%- assign product_count = product_count | plus: 1 -%}
                {%- endif -%}
              {%- endfor -%}
            </ul>
          {%- endif -%}
          
          <p>
            Visit us at <strong>1520 SE 46th Ln, Unit B, Cape Coral, FL 33904</strong> or 
            call <strong>(239) 955-0314</strong> to learn more. 
            Serving Cape Coral, Fort Myers, and all of Southwest Florida.
          </p>
          
          <p class="collection-related-links">
            <strong>Explore More Collections:</strong>
            {%- for coll in collections limit: 5 -%}
              {%- if coll.handle != collection.handle and coll.all_products_count > 0 -%}
                <a href="{{ coll.url }}">{{ coll.title }}</a>
                {%- unless forloop.last %} | {% endunless -%}
              {%- endif -%}
            {%- endfor -%}
          </p>
        </div>
      {%- endif -%}
    </div>
  </details>
</div>

<style>
  .collection-seo-content {
    margin: 4rem auto;
    max-width: 1200px;
    padding: 0 2rem;
  }
  
  .collection-about-details {
    background: #f9f9f9;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 2rem;
    transition: all 0.3s ease;
  }
  
  .collection-about-details[open] {
    background: #ffffff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  
  .collection-about-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    list-style: none;
    user-select: none;
  }
  
  .collection-about-summary::-webkit-details-marker {
    display: none;
  }
  
  .collection-about-summary h2 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
    color: #333;
  }
  
  .collection-about-toggle {
    display: flex;
    align-items: center;
    transition: transform 0.3s ease;
  }
  
  .collection-about-details[open] .collection-about-toggle {
    transform: rotate(180deg);
  }
  
  .icon-chevron {
    color: #ff6600;
  }
  
  .collection-about-content {
    margin-top: 2rem;
    line-height: 1.7;
    color: #555;
  }
  
  .collection-about-content h3 {
    font-size: 1.6rem;
    font-weight: 600;
    margin: 2rem 0 1rem;
    color: #333;
  }
  
  .collection-about-content p {
    margin-bottom: 1.5rem;
  }
  
  .collection-featured-products {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }
  
  .collection-featured-products li {
    padding: 0.8rem 0;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .collection-featured-products li:last-child {
    border-bottom: none;
  }
  
  .collection-featured-products a {
    color: #ff6600;
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s ease;
  }
  
  .collection-featured-products a:hover {
    color: #cc5200;
    text-decoration: underline;
  }
  
  .collection-related-links {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e0e0e0;
  }
  
  .collection-related-links a {
    color: #ff6600;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }
  
  .collection-related-links a:hover {
    color: #cc5200;
    text-decoration: underline;
  }
  
  @media (max-width: 768px) {
    .collection-seo-content {
      padding: 0 1.5rem;
      margin: 3rem auto;
    }
    
    .collection-about-details {
      padding: 1.5rem;
    }
    
    .collection-about-summary h2 {
      font-size: 1.6rem;
    }
  }
</style>
{%- endif -%}

