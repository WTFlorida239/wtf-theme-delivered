{%- if product -%}
  {%- assign selected_variant = product.selected_or_first_available_variant -%}
  {%- assign product_images = product.media | where: 'media_type', 'image' -%}
  {%- if selected_variant -%}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": {{ product.title | json }},
        {%- if product.description != blank -%}
        "description": {{ product.description | strip_html | truncate: 500 | json }},
        {%- endif -%}
        {%- if selected_variant.sku != blank -%}
        "sku": {{ selected_variant.sku | json }},
        {%- endif -%}
        {%- if product.vendor != blank -%}
        "brand": {
          "@type": "Brand",
          "name": {{ product.vendor | json }}
        },
        {%- endif -%}
        {%- if product_images.size > 0 -%}
        "image": [
          {%- for media in product_images limit: 10 -%}
            {{ media | image_url: width: 1200 | json }}{%- unless forloop.last -%},{%- endunless -%}
          {%- endfor -%}
        ],
        {%- endif -%}
        "url": {{ request.origin | append: product.url | json }},
        "offers": {
          "@type": "Offer",
          "priceCurrency": {{ shop.currency | json }},
          "price": {{ selected_variant.price | money_without_currency | strip | replace: ',', '' | replace: ' ', '' | replace: 'Â ', '' | json }},
          "availability": "https://schema.org/{% if selected_variant.available %}InStock{% else %}OutOfStock{% endif %}",
          "url": {{ request.origin | append: product.url | json }}{%- if selected_variant.sku != blank -%},
          "sku": {{ selected_variant.sku | json }}{%- endif -%}
        }
        {%- if product.metafields.seo and product.metafields.seo.mpn != blank -%},
        "mpn": {{ product.metafields.seo.mpn | json }}
        {%- endif -%}
        {%- if product.rating_value and product.rating_count -%},
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": {{ product.rating_value | json }},
          "reviewCount": {{ product.rating_count | json }}
        }
        {%- endif -%}
      }
    </script>
  {%- endif -%}
{%- endif -%}
