{% comment %}
  WTF Theme — Header
  - Accessible skip links
  - Configurable logo + main menu
  - Search (optional)
  - Social icons (optional)
  - Cart link with live count badge (data-cart-count)
  - Mobile menu with <details> for native a11y & no-JS fallback
  - Tiny progressive enhancement for search drawer toggle
{% endcomment %}

<!-- Skip Links -->
<nav class="skip-links" aria-label="Skip links">
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <a class="skip-link" href="#main-navigation">Skip to navigation</a>
</nav>

<header class="site-header" role="banner" data-section-id="{{ section.id }}">
  <div class="site-header__inner page-width">

    {%- comment -%} Logo {%- endcomment -%}
    <div class="site-header__brand">
      <a href="{{ routes.root_url }}" class="site-header__logo-link" aria-label="{{ shop.name }}">
        {%- if section.settings.logo != blank -%}
          <img
            class="site-header__logo"
            src="{{ section.settings.logo | image_url: width: 220 }}"
            alt="{{ shop.name }}"
            width="220"
            height="{{ 220 | divided_by: section.settings.logo.aspect_ratio | round }}"
            loading="eager">
        {%- else -%}
          <img
            class="site-header__logo"
            src="{{ 'WTFLogo.png' | asset_url }}"
            alt="{{ shop.name }}"
            width="140"
            height="140"
            loading="eager">
        {%- endif -%}
      </a>
    </div>

    {%- comment -%} Primary Nav (details for a11y mobile) {%- endcomment -%}
    <details class="site-header__nav" id="main-navigation" data-mobile-nav>
      <summary class="site-header__nav-toggle" aria-controls="menu-drawer" aria-expanded="false">
        <span class="visually-hidden">Toggle menu</span>
        <span class="hamburger" aria-hidden="true"></span>
      </summary>

      <nav id="menu-drawer" class="site-header__menu" role="navigation" aria-label="Primary">
        {%- assign menu = section.settings.menu | default: 'main-menu' -%}
        {%- if linklists[menu] and linklists[menu].links.size > 0 -%}
          <ul class="menu">
            {%- for link in linklists[menu].links -%}
              <li class="menu__item">
                <a class="menu__link {% if link.active %}is-active{% endif %}" href="{{ link.url }}">
                  {{ link.title }}
                </a>

                {%- if link.links and link.links.size > 0 -%}
                  <details class="submenu">
                    <summary class="submenu__toggle">
                      <span class="submenu__label">More</span>
                    </summary>
                    <ul class="submenu__list">
                      {%- for child in link.links -%}
                        <li class="submenu__item">
                          <a class="submenu__link" href="{{ child.url }}">{{ child.title }}</a>
                        </li>
                      {%- endfor -%}
                    </ul>
                  </details>
                {%- endif -%}
              </li>
            {%- endfor -%}
          </ul>
        {%- endif -%}
      </nav>
    </details>

    {%- comment -%} Header Actions {%- endcomment -%}
    <div class="site-header__actions">
      {%- if section.settings.show_search -%}
        <button class="action-icon" data-search-toggle aria-label="Open search">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
          </svg>
        </button>
      {%- endif -%}

      {%- if section.settings.show_social_icons -%}
        <div class="site-header__social">
          {% render 'social-media-icons', style: 'header', size: 'small' %}
        </div>
      {%- endif -%}

      <a href="{{ routes.cart_url }}" class="action-icon header-cart" aria-label="Cart">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.7 13.4a2 2 0 0 0 2 1.6h9.6a2 2 0 0 0 2-1.6L23 6H6"/>
        </svg>
        <span class="cart-count-badge {% if cart.item_count == 0 %}is-empty{% endif %}" data-cart-count>
          {{ cart.item_count }}
        </span>
      </a>
    </div>
  </div>

  {%- if section.settings.show_search -%}
    <div class="site-header__search" hidden data-search-drawer>
      <div class="site-header__search-inner page-width">
        <form class="search-form" action="{{ routes.search_url }}" method="get" role="search" novalidate>
          <label class="visually-hidden" for="Search-In-Header">Search</label>
          <input
            id="Search-In-Header"
            class="search-input"
            type="search"
            name="q"
            placeholder="Search products…"
            autocomplete="off"
            enterkeyhint="search">
          <button class="search-submit" type="submit" aria-label="Submit search">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
          </button>
        </form>
        <noscript>
          <style>.site-header__search[hidden]{display:block!important}</style>
        </noscript>
      </div>
    </div>
  {%- endif -%}
</header>

{%- comment -%} Minimal styles (kept small; theme CSS can refine) {%- endcomment -%}
<style>
.skip-links { position:absolute; left:-9999px; }
.skip-links:focus-within { position:static; padding:0.5rem; }
.skip-link { margin-right:1rem; }

.site-header { position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid #eee; }
.page-width { max-width: 1200px; margin: 0 auto; padding: .75rem 1rem; }
.site-header__inner { display:flex; align-items:center; justify-content:space-between; gap:1rem; }
.site-header__logo { display:block; max-height:60px; height:auto; width:auto; }

.site-header__nav { display:block; }
.site-header__nav > summary { list-style:none; display:none; cursor:pointer; border:0; background:transparent; }
.site-header__nav[open] > summary[aria-expanded] { aria-expanded: true; }

.site-header__menu .menu { display:flex; gap:1.5rem; margin:0; padding:0; list-style:none; }
.menu__link { text-decoration:none; color:#333; font-weight:600; }
.menu__link.is-active, .menu__link:hover { color:#ff6600; }

.submenu { position:relative; }
.submenu > summary { cursor:pointer; list-style:none; border:0; background:transparent; padding: .25rem 0; color:#666; }
.submenu__list { position:absolute; left:0; top:100%; background:#fff; border:1px solid #eee; border-radius:.5rem; box-shadow:0 8px 24px rgba(0,0,0,.08); list-style:none; margin:.25rem 0 0; padding:.5rem 0; min-width:220px; }
.submenu[open] .submenu__list { display:block; }
.submenu__link { display:block; padding:.5rem 1rem; color:#333; text-decoration:none; }
.submenu__link:hover { background:#f8f8f8; color:#ff6600; }

.site-header__actions { display:flex; align-items:center; gap:.5rem; }
.action-icon { position:relative; display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:999px; border:0; background:transparent; cursor:pointer; color:#333; text-decoration:none; }
.action-icon:hover { background:#f8f8f8; }

.cart-count-badge { position:absolute; top:-6px; right:-6px; min-width:20px; height:20px; padding:0 6px; border-radius:999px; display:inline-flex; align-items:center; justify-content:center; background:#ff6600; color:#fff; font-size:.75rem; font-weight:700; line-height:1; }
.cart-count-badge.is-empty { display:none; }

.site-header__search[hidden] { display:none; }
.search-form { position:relative; max-width:720px; margin: .5rem auto; }
.search-input { width:100%; padding: .75rem 2.5rem .75rem .75rem; border:2px solid #ddd; border-radius: .5rem; font-size:1rem; }
.search-input:focus { outline: none; border-color:#ff6600; }
.search-submit { position:absolute; right:.5rem; top:50%; transform:translateY(-50%); border:0; background:transparent; cursor:pointer; color:#666; }

.hamburger { width:22px; height:14px; position:relative; display:inline-block; }
.hamburger::before, .hamburger::after { content:""; position:absolute; left:0; right:0; height:2px; background:#333; }
.hamburger::before { top:0; }
.hamburger::after { bottom:0; }
@media (max-width: 990px){
  .site-header__menu .menu { gap:1rem; }
}
@media (max-width: 768px){
  .site-header__inner { gap:.75rem; }
  .site-header__nav > summary { display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:999px; }
  .site-header__menu .menu { flex-direction:column; gap:0; }
  .submenu__list { position:static; box-shadow:none; border-radius:0; border:0; margin:0; }
}
.visually-hidden { position:absolute!important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
</style>

<script>
/* Progressive enhancement: search drawer toggle */
document.addEventListener('DOMContentLoaded', () => {
  const toggle = document.querySelector('[data-search-toggle]');
  const drawer = document.querySelector('[data-search-drawer]');
  if (!toggle || !drawer) return;

  toggle.addEventListener('click', () => {
    const isHidden = drawer.hasAttribute('hidden');
    if (isHidden) drawer.removeAttribute('hidden'); else drawer.setAttribute('hidden','');
    const input = drawer.querySelector('.search-input');
    if (isHidden && input) setTimeout(() => input.focus(), 80);
  });
});
</script>

{% schema %}
{
  "name": "Header",
  "tag": "header",
  "class": "section-header",
  "settings": [
    { "type": "image_picker", "id": "logo", "label": "Logo image" },
    { "type": "link_list", "id": "menu", "label": "Main menu", "default": "main-menu" },
    { "type": "checkbox", "id": "show_search", "label": "Show search", "default": true },
    { "type": "checkbox", "id": "show_social_icons", "label": "Show social icons", "default": true }
  ],
  "presets": [{ "name": "Header" }]
}
{% endschema %}
