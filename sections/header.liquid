{% comment %}
  WTF Theme — Header (markup-only)
  - Accessible skip links
  - Configurable logo + main menu
  - Optional search & social icons
  - Cart link with live badge (data-cart-count)
  - Mobile menu uses <details>/<summary> for a11y + no-JS fallback
  - Loads wtf-header.css and wtf-header.js (assets)
{% endcomment %}

{{ 'wtf-header.css' | asset_url | stylesheet_tag }}

<header class="site-header" role="banner" data-section-id="{{ section.id }}">
  <nav class="skip-links" aria-label="Skip links">
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <a class="skip-link" href="#main-navigation">Skip to navigation</a>
  </nav>

  <div class="site-header__inner page-width">
    <!-- Brand -->
    <div class="site-header__brand">
      <a href="{{ routes.root_url }}" class="site-header__logo-link" aria-label="{{ shop.name }}">
        {% if section.settings.logo != blank %}
          <img
            class="site-header__logo"
            src="{{ section.settings.logo | image_url: width: 220 }}"
            alt="{{ shop.name }}"
            width="220"
            height="{{ 220 | divided_by: section.settings.logo.aspect_ratio | round }}"
            loading="eager">
        {% else %}
          <img
            class="site-header__logo"
            src="{{ 'WTFLogo.png' | asset_url }}"
            alt="{{ shop.name }}"
            width="140"
            height="140"
            loading="eager">
        {% endif %}
      </a>
    </div>

    <!-- Primary Nav (mobile-friendly with details/summary) -->
    <details class="site-header__nav" id="main-navigation" data-mobile-nav open>
      <summary class="site-header__nav-toggle" aria-controls="menu-drawer" aria-expanded="true">
        <span class="visually-hidden">Toggle menu</span>
        <span class="hamburger" aria-hidden="true"></span>
      </summary>

      <nav id="menu-drawer" class="site-header__menu" role="navigation" aria-label="Primary">
        {% assign menu_handle = section.settings.menu | default: 'main-menu' %}
        {% if linklists[menu_handle] and linklists[menu_handle].links.size > 0 %}
          <ul class="menu">
            {% for link in linklists[menu_handle].links %}
              <li class="menu__item">
                <a class="menu__link {% if link.active %}is-active{% endif %}" href="{{ link.url }}">
                  {{ link.title }}
                </a>

                {% if link.links and link.links.size > 0 %}
                  <details class="submenu">
                    <summary class="submenu__toggle">
                      <span class="submenu__label">More</span>
                    </summary>
                    <ul class="submenu__list">
                      {% for child in link.links %}
                        <li class="submenu__item">
                          <a class="submenu__link" href="{{ child.url }}">{{ child.title }}</a>
                        </li>
                      {% endfor %}
                    </ul>
                  </details>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </nav>
    </details>

    <!-- Actions -->
    <div class="site-header__actions">
      {% if section.settings.show_search %}
        <button class="action-icon" data-search-toggle aria-label="Open search">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
          </svg>
        </button>
      {% endif %}

      {% if section.settings.show_social_icons %}
        <div class="site-header__social">
          {% render 'social-media-icons', style: 'header', size: 'small' %}
        </div>
      {% endif %}

      <a href="{{ routes.cart_url }}" class="action-icon header-cart" aria-label="Cart">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.7 13.4a2 2 0 0 0 2 1.6h9.6a2 2 0 0 0 2-1.6L23 6H6"/>
        </svg>
        <span class="cart-count-badge {% if cart.item_count == 0 %}is-empty{% endif %}" data-cart-count>
          {{ cart.item_count }}
        </span>
      </a>
    </div>
  </div>

  {% if section.settings.show_search %}
    <div class="site-header__search" hidden data-search-drawer>
      <div class="site-header__search-inner page-width">
        <form class="search-form" action="{{ routes.search_url }}" method="get" role="search" novalidate>
          <label class="visually-hidden" for="Search-In-Header">Search</label>
          <input
            id="Search-In-Header"
            class="search-input"
            type="search"
            name="q"
            placeholder="Search products…"
            autocomplete="off"
            enterkeyhint="search">
          <button class="search-submit" type="submit" aria-label="Submit search">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
          </button>
        </form>
        <noscript>
          <style>.site-header__search[hidden]{display:block!important}</style>
        </noscript>
      </div>
    </div>
  {% endif %}
</header>

<script src="{{ 'wtf-header.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Header",
  "tag": "header",
  "class": "section-header",
  "settings": [
    { "type": "image_picker", "id": "logo", "label": "Logo image" },
    { "type": "link_list", "id": "menu", "label": "Main menu", "default": "main-menu" },
    { "type": "checkbox", "id": "show_search", "label": "Show search", "default": true },
    { "type": "checkbox", "id": "show_social_icons", "label": "Show social icons", "default": true }
  ],
  "presets": [{ "name": "Header" }]
}
{% endschema %}
