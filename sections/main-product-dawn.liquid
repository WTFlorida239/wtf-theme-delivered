{% comment %}
  Main product section with Dawn-style cart integration
  Uses wtf-product-form custom element for AJAX add-to-cart
{% endcomment %}

<div class="product" data-section-id="{{ section.id }}" data-section-type="product" data-product-id="{{ product.id }}">
  <div class="product__container">
    {% if product.media.size > 0 %}
      <div class="product__media">
        {% for media in product.media limit: 1 %}
          {% if media.media_type == 'image' %}
            <img src="{{ media | image_url: width: 600 }}" 
                 alt="{{ media.alt | escape }}"
                 class="product__image"
                 loading="lazy"
                 width="600"
                 height="600">
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <div class="product__info">
      <wtf-product-form data-hide-errors="false">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'title' %}
              <h1 class="product__title">{{ product.title }}</h1>
            
            {% when 'price' %}
              <div class="product__price">
                {% if product.compare_at_price > product.price %}
                  <span class="product__price--compare">${{ product.compare_at_price | money_without_currency }}</span>
                {% endif %}
                <span class="product__price--current">${{ product.price | money_without_currency }}</span>
              </div>
            
            {% when 'variant_picker' %}
              {% unless product.has_only_default_variant %}
                <div class="product__variants">
                  {% for option in product.options_with_values %}
                    <div class="product__option">
                      <label class="product__option-label">{{ option.name }}</label>
                      <select name="options[{{ option.name | escape }}]" 
                              id="Option-{{ section.id }}-{{ forloop.index0 }}"
                              class="product__option-select">
                        {% for value in option.values %}
                          <option value="{{ value | escape }}"
                                  {% if option.selected_value == value %}selected="selected"{% endif %}>
                            {{ value }}
                          </option>
                        {% endfor %}
                      </select>
                    </div>
                  {% endfor %}
                </div>
              {% endunless %}
            
            {% when 'quantity_selector' %}
              <div class="product__quantity">
                <label for="Quantity-{{ section.id }}" class="product__quantity-label">Quantity</label>
                <input type="number" 
                       id="Quantity-{{ section.id }}"
                       name="quantity" 
                       value="1" 
                       min="1"
                       class="product__quantity-input">
              </div>
            
            {% when 'buy_buttons' %}
              <div class="product__buttons">
                <form method="post" 
                      action="{{ routes.cart_add_url }}" 
                      accept-charset="UTF-8" 
                      enctype="multipart/form-data" 
                      class="product__form">
                  <input type="hidden" name="form_type" value="product">
                  <input type="hidden" name="utf8" value="âœ“">
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                  
                  <div class="product-form__error-message-wrapper" hidden>
                    <span class="product-form__error-message"></span>
                  </div>

                  <div class="product-form__success-message hidden">
                    Item added to cart!
                  </div>
                  
                  <button type="submit" 
                          name="add"
                          class="product__add-to-cart btn btn--primary"
                          {% unless product.available %}disabled{% endunless %}>
                    <span class="loading__spinner hidden"></span>
                    <span>
                      {% if product.available %}
                        Add to Cart - ${{ product.price | money_without_currency }}
                      {% else %}
                        Sold Out
                      {% endif %}
                    </span>
                  </button>
                  
                  {% if block.settings.show_dynamic_checkout and product.available %}
                    {{ form | payment_button }}
                  {% endif %}
                </form>
              </div>
            
            {% when 'description' %}
              {% if product.description != blank %}
                <div class="product__description">
                  {{ product.description }}
                </div>
              {% endif %}
              
              {%- render 'product-category-specs', product: product -%}
            
            {% when 'share' %}
              <div class="product__share">
                <button type="button" class="share-button" id="Share-{{ section.id }}">
                  Share
                </button>
              </div>
          {% endcase %}
        {% endfor %}
      </wtf-product-form>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Product information",
  "tag": "section",
  "class": "section",
  "blocks": [
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "Variant picker",
      "limit": 1
    },
    {
      "type": "quantity_selector",
      "name": "Quantity selector",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "Buy buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": true,
          "label": "Show dynamic checkout buttons"
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1
    }
  ]
}
{% endschema %}

