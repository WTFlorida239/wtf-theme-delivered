<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>THC Drinks - WTF | Welcome To Florida</title>

    <style>
      /* ——— Base / Layout ——— */
      * { box-sizing: border-box; margin: 0; padding: 0; }
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
        line-height: 1.6; 
        color:#333; 
        min-height: 100vh;
      }
      .header { 
        background: linear-gradient(135deg, #ff6600 0%, #e55a00 100%); 
        color: #fff; 
        padding: 20px 0; 
        text-align: center; 
        font-size: 28px; 
        font-weight: 800; 
        box-shadow: 0 4px 20px rgba(255,102,0,0.3);
      }
      .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
      .back-link { 
        display: inline-block; 
        color: #ff6600; 
        text-decoration: none; 
        font-weight: 700; 
        font-size: 16px; 
        margin-bottom: 30px; 
        padding: 12px 20px; 
        border: 3px solid #ff6600; 
        border-radius: 25px; 
        transition: all .3s ease; 
        background: #fff;
        box-shadow: 0 4px 15px rgba(255,102,0,0.2);
      }
      .back-link:hover { 
        background: #ff6600; 
        color: #fff; 
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255,102,0,0.4);
      }
      .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; align-items: start; }
      .product-image { 
        width: 100%; 
        max-width: 400px; 
        border-radius: 20px; 
        box-shadow: 0 8px 30px rgba(0,0,0,.15); 
        height:auto; 
        transition: transform .3s ease;
      }
      .product-image:hover { transform: scale(1.02); }
      .product-details { 
        background: #fff; 
        padding: 40px; 
        border-radius: 20px; 
        box-shadow: 0 8px 30px rgba(0,0,0,.1); 
        border: 1px solid #f0f0f0;
      }
      .product-title { 
        font-size: 36px; 
        margin-bottom: 15px; 
        font-weight: 900; 
        background: linear-gradient(135deg, #ff6600 0%, #e55a00 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .product-price { 
        font-size: 28px; 
        color: #ff6600; 
        font-weight: 800; 
        margin-bottom: 20px; 
        text-shadow: 0 2px 4px rgba(255,102,0,0.2);
      }
      .product-description { color: #666; margin-bottom: 35px; font-size: 17px; line-height: 1.7; }
      .selection-section { 
        margin: 35px 0; 
        border-bottom: 2px solid #f0f0f0; 
        padding-bottom: 25px; 
        transition: all .3s ease;
      }
      .selection-section:last-child { border-bottom: none; }
      .section-title { 
        font-size: 20px; 
        font-weight: 800; 
        margin-bottom: 18px; 
        color: #333;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
      }
      .info-box { 
        background: linear-gradient(135deg, #e7f3ff 0%, #d1ecf1 100%); 
        padding: 18px; 
        border-radius: 12px; 
        margin-bottom: 18px; 
        font-size: 15px; 
        border: 1px solid #bee5eb;
        box-shadow: 0 2px 8px rgba(0,123,255,0.1);
      }
      .age-warning { 
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); 
        color: #856404; 
        padding: 18px; 
        border-radius: 12px; 
        margin-bottom: 18px; 
        font-size: 15px; 
        border: 2px solid #ffeaa7; 
        box-shadow: 0 4px 15px rgba(255,193,7,0.2);
        font-weight: 600;
      }

      /* ——— Options ——— */
      .option-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap: 12px; }
      .option-button { 
        padding: 18px; 
        border: 3px solid #e0e0e0; 
        border-radius: 15px; 
        text-align: center; 
        background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); 
        cursor: pointer; 
        transition: all .3s ease; 
        color:#333; 
        font-size: 15px; 
        font-weight: 600;
        min-height: 70px; 
        display:flex; 
        align-items:center; 
        justify-content:center; 
        flex-direction:column; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        position: relative;
        overflow: hidden;
      }
      .option-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        transition: left .5s ease;
      }
      .option-button:hover::before {
        left: 100%;
      }
      .option-button:hover { 
        border-color: #ff6600; 
        transform: translateY(-3px); 
        box-shadow: 0 8px 25px rgba(255,102,0,0.25); 
        background: linear-gradient(135deg, #fff 0%, #fff5f0 100%);
      }
      .option-button.selected { 
        background: linear-gradient(135deg, #ff6600 0%, #e55a00 100%); 
        color: #fff; 
        border-color: #ff6600; 
        font-weight: 800; 
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255,102,0,0.4);
      }

      /* THC-specific colors */
      .thc-flavor.selected { background: #9c27b0; border-color: #9c27b0; }

      /* Flavor Categories */
      .flavor-category { margin-bottom: 25px; }
      .flavor-category-title { 
        font-size: 16px; 
        font-weight: 700; 
        color: #333; 
        margin-bottom: 10px; 
        text-align: center;
        padding: 8px 15px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 20px;
        border: 2px solid #dee2e6;
      }
      .flavor-category-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
        gap: 8px; 
      }

      /* ——— Quantity ——— */
      .quantity-controls { display:flex; align-items:center; gap: 15px; }
      .qty-btn { width: 40px; height: 40px; border: 2px solid #ff6600; background:#fff; color:#ff6600; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: 700; transition: all .12s ease; }
      .qty-btn:hover { background:#ff6600; color:#fff; transform: scale(1.08); }
      .qty-input { width: 80px; text-align:center; padding:10px; border:2px solid #ddd; border-radius:5px; font-size:16px; }

      /* ——— Comments ——— */
      .comments-textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; resize: vertical; font-size: 14px; line-height: 1.4; }
      .comments-textarea:focus { border-color: #ff6600; outline: none; }

      /* ——— CTA / Status ——— */
      .add-to-cart-btn { 
        width: 100%; 
        padding: 22px; 
        background: linear-gradient(135deg, #ff6600 0%, #e55a00 100%); 
        color: #fff; 
        border: none; 
        border-radius: 25px; 
        font-size: 20px; 
        font-weight: 800; 
        cursor: pointer; 
        margin-top: 30px; 
        transition: all .3s ease; 
        box-shadow: 0 6px 20px rgba(255,102,0,0.3);
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
      }
      .add-to-cart-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left .5s ease;
      }
      .add-to-cart-btn:hover::before {
        left: 100%;
      }
      .add-to-cart-btn:hover { 
        background: linear-gradient(135deg, #e55a00 0%, #d14900 100%); 
        transform: translateY(-3px); 
        box-shadow: 0 10px 30px rgba(255,102,0,0.4); 
      }
      .add-to-cart-btn:disabled { 
        background: linear-gradient(135deg, #ccc 0%, #bbb 100%); 
        cursor: not-allowed; 
        transform: none; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
      }
      .success-message { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 15px 0; border: 1px solid #c3e6cb; display: none; font-size: 14px; }
      .success-message.show { display: block; }
      .cart-status { position: fixed; top: 20px; right: 20px; background:#ff6600; color:#fff; padding:10px 15px; border-radius:25px; font-weight:700; z-index:1000; box-shadow:0 4px 12px rgba(255,102,0,0.3); }

      /* ——— Motion preferences ——— */
      @media (prefers-reduced-motion: reduce){
        .back-link, .option-button, .qty-btn, .add-to-cart-btn { transition: none !important; }
      }

      /* ——— Responsive ——— */
      @media (max-width: 768px){
        .product-grid { grid-template-columns: 1fr; gap:24px; }
        .option-grid { grid-template-columns: repeat(2,1fr); }
        .product-details { padding: 20px; }
      }

      /* Focus visible outline */
      :where(.back-link, .option-button, .qty-btn, .add-to-cart-btn):focus-visible { outline: 3px solid #1a73e8; outline-offset: 2px; border-radius: 8px; }
      .sr-only { position:absolute!important; width:1px; height:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
    </style>

    <script>
      window.THC_DRINKS_VARIANT_ID = {{ page.metafields.custom.thc_drinks_variant_id | default: settings.thc_drinks_variant_id | json }};
      
      // ——— EASILY EDITABLE THC FLAVORS (syncs with THC Shots) ———
      // 👇 EDIT THESE 4 FLAVORS TO ROTATE YOUR SELECTION 👇
      window.THC_ROTATING_FLAVORS = [
        'Tropical Mango',
        'Berry Blast', 
        'Citrus Punch',
        'Grape Escape'
      ];
      // 👆 EDIT THESE 4 FLAVORS TO ROTATE YOUR SELECTION 👆
    </script>
  </head>

  <body>
    <div class="header">WTF | Welcome To Florida</div>
    <div class="cart-status" id="cart-status" aria-live="polite">
      Cart: <span id="cart-count">{{ cart.item_count }}</span> items
    </div>

    <div class="container">
      <a href="/" class="back-link">← Back to Menu</a>

      <div class="product-grid">
        <div class="product-image-section">
          <img
            src="{{ 'delta9_drinks_150x150.png' | asset_url }}"
            alt="THC Drinks"
            class="product-image"
            width="400"
            height="400"
            loading="eager"
            fetchpriority="high"
          >
        </div>

        <div class="product-details">
          <h1 class="product-title">THC Drinks</h1>
          <div class="product-price" id="product-price">$15.99 - Large • Gallon Only</div>
          
          <div class="age-warning">
            <strong>⚠️ 21+ Only:</strong> Must be 21 or older to purchase. Valid ID required. Cannabis beverages with rotating flavors.
          </div>
          
          <p class="product-description">
            Premium cannabis beverages - Large size and Gallon only. House-made with rotating flavors for the ultimate experience.
          </p>

          <!-- Size Selection (Large & Gallon Only) -->
          <div class="selection-section">
            <h3 class="section-title">📏 Choose Your Size</h3>
            <div class="info-box">
              <strong>Available Sizes:</strong> Large and Gallon only for THC drinks
            </div>
            <div class="option-grid" id="size-options" role="group" aria-label="Size options">
              <button type="button" class="option-button" data-size="Large" data-price="15.99">
                <strong>Large</strong><br>
                <small>$15.99</small>
              </button>
              <button type="button" class="option-button" data-size="Gallon" data-price="45.99">
                <strong>Gallon</strong><br>
                <small>$45.99</small>
              </button>
            </div>
          </div>

          <!-- Comprehensive Flavor Selection -->
          <div class="selection-section">
            <h3 class="section-title">🍹 Choose Your Flavor</h3>
            <div class="info-box">
              <strong>Full Selection:</strong> Choose from our complete flavor menu - same options as our kava drinks for consistency.
            </div>
            <div class="option-grid" id="flavor-options" role="group" aria-label="Flavor options">
              <!-- Flavors will be populated by JavaScript from the rotating array -->
            </div>
          </div>

          <!-- THC Concentration (for Gallon size) -->
          <div class="selection-section" id="thc-concentration-section" style="display: none;">
            <h3 class="section-title">🧪 THC Concentration (Gallon Only)</h3>
            <div class="info-box">
              <strong>Gallon Special:</strong> Choose your preferred THC concentration for the full gallon.
            </div>
            <div class="option-grid" id="thc-concentration-options" role="group" aria-label="THC concentration options">
              <button type="button" class="option-button" data-concentration="Low (5mg per serving)">Low<br><small>5mg per serving</small></button>
              <button type="button" class="option-button" data-concentration="Medium (10mg per serving)">Medium<br><small>10mg per serving</small></button>
              <button type="button" class="option-button" data-concentration="High (25mg per serving)">High<br><small>25mg per serving</small></button>
              <button type="button" class="option-button" data-concentration="Custom">Custom<br><small>Specify in comments</small></button>
            </div>
          </div>

          <!-- Ice Options -->
          <div class="selection-section">
            <h3 class="section-title">🧊 Ice Preference</h3>
            <div class="option-grid" id="ice-options" role="group" aria-label="Ice options">
              <button type="button" class="option-button" data-ice="Regular Ice">Regular Ice</button>
              <button type="button" class="option-button" data-ice="Light Ice">Light Ice</button>
              <button type="button" class="option-button" data-ice="Extra Ice">Extra Ice</button>
              <button type="button" class="option-button" data-ice="No Ice">No Ice</button>
            </div>
          </div>

          <!-- Comments -->
          <div class="selection-section">
            <h3 class="section-title">💬 Special Requests & Comments</h3>
            <label for="order-comments" class="sr-only">Order comments</label>
            <textarea
              id="order-comments"
              class="comments-textarea"
              placeholder="Any special requests, dosage preferences, or modifications? We'll try to accommodate!"
              rows="3"
            ></textarea>
          </div>

          <!-- Quantity -->
          <div class="selection-section">
            <h3 class="section-title">🔢 Quantity</h3>
            <div class="quantity-controls">
              <button type="button" class="qty-btn" aria-label="Decrease quantity" onclick="changeQuantity(-1)">
                −
              </button>
              <input
                type="number"
                id="quantity"
                value="1"
                min="1"
                max="50"
                class="qty-input"
                inputmode="numeric"
                pattern="[0-9]*"
              >
              <button type="button" class="qty-btn" aria-label="Increase quantity" onclick="changeQuantity(1)">
                +
              </button>
            </div>
          </div>

          <div id="success-message" class="success-message" role="status" aria-live="polite"></div>

          <button type="button" id="add-to-cart-btn" class="add-to-cart-btn" onclick="addToCart()" disabled>
            Select Size & Flavor
          </button>
        </div>
      </div>
    </div>

    <script>
      // ——— Currency formatter ———
      const moneyFmt = new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' });

      // ——— State ———
      let selectedSize = null;
      let selectedFlavor = null;
      let selectedIce = 'Regular Ice';
      let selectedConcentration = null;
      let basePrice = 15.99;

      // ——— Init ———
      document.addEventListener('DOMContentLoaded', () => {
        populateRotatingFlavors();
        wireOptionButtons();
        updateCartCount();
        updateUI();
      });

      function populateRotatingFlavors() {
        const flavorContainer = document.getElementById('flavor-options');
        
        // Categorized flavor list for better user experience
        const flavorCategories = {
          'Tropical': ['Coconut', 'Pineapple', 'Mango', 'Passion Fruit', 'Tropical Mango'],
          'Citrus': ['Lime', 'Lemon', 'Orange', 'Citrus Punch'],
          'Berry': ['Strawberry', 'Blueberry', 'Berry Blast', 'Cherry', 'Watermelon'],
          'Classic': ['Vanilla', 'Chocolate', 'Caramel', 'Mint'],
          'Specialty': ['Ginger', 'Cinnamon', 'Peach', 'Grape Escape']
        };
        
        flavorContainer.innerHTML = '';
        
        // Create categorized display
        Object.entries(flavorCategories).forEach(([category, flavors]) => {
          const categoryDiv = document.createElement('div');
          categoryDiv.className = 'flavor-category';
          categoryDiv.innerHTML = `<h4 class="flavor-category-title">${category}</h4>`;
          
          const categoryGrid = document.createElement('div');
          categoryGrid.className = 'flavor-category-grid';
          
          flavors.forEach(flavor => {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'option-button thc-flavor';
            button.dataset.flavor = flavor;
            button.innerHTML = `<strong>${flavor}</strong>`;
            categoryGrid.appendChild(button);
          });
          
          categoryDiv.appendChild(categoryGrid);
          flavorContainer.appendChild(categoryDiv);
        });
      }

      function wireOptionButtons() {
        // Size buttons
        document.querySelectorAll('#size-options .option-button').forEach((btn) => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('#size-options .option-button').forEach((b) => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedSize = btn.dataset.size;
            const p = parseFloat(btn.dataset.price || '');
            if (Number.isFinite(p)) basePrice = p;
            
            // Show/hide THC concentration section for Gallon size
            const concentrationSection = document.getElementById('thc-concentration-section');
            if (selectedSize === 'Gallon') {
              concentrationSection.style.display = 'block';
            } else {
              concentrationSection.style.display = 'none';
              selectedConcentration = null;
              document.querySelectorAll('#thc-concentration-options .option-button').forEach((b) => b.classList.remove('selected'));
            }
            
            updateUI();
          });
        });

        // Flavor buttons (dynamically created)
        document.addEventListener('click', (e) => {
          if (e.target.matches('#flavor-options .option-button')) {
            document.querySelectorAll('#flavor-options .option-button').forEach((b) => b.classList.remove('selected'));
            e.target.classList.add('selected');
            selectedFlavor = e.target.dataset.flavor;
            updateUI();
          }
        });

        // THC concentration buttons
        document.querySelectorAll('#thc-concentration-options .option-button').forEach((btn) => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('#thc-concentration-options .option-button').forEach((b) => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedConcentration = btn.dataset.concentration;
            updateUI();
          });
        });

        // Ice buttons
        document.querySelectorAll('#ice-options .option-button').forEach((btn) => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('#ice-options .option-button').forEach((b) => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedIce = btn.dataset.ice;
            updateUI();
          });
        });

        // Set defaults
        document.querySelector('[data-ice="Regular Ice"]').classList.add('selected');
      }

      function updateUI() {
        const sizeText = selectedSize ? ` - ${selectedSize}` : ' - Large • Gallon Only';
        document.getElementById('product-price').textContent = `${moneyFmt.format(basePrice)}${sizeText}`;
        
        const button = document.getElementById('add-to-cart-btn');
        const qty = Math.max(1, Math.min(50, parseInt(document.getElementById('quantity').value || '1', 10)));
        const total = basePrice * qty;

        const isGallonWithoutConcentration = selectedSize === 'Gallon' && !selectedConcentration;
        
        if (selectedSize && selectedFlavor && !isGallonWithoutConcentration) {
          button.textContent = `Add to Cart — ${moneyFmt.format(total)}`;
          button.disabled = false;
        } else if (isGallonWithoutConcentration) {
          button.textContent = 'Select THC Concentration';
          button.disabled = true;
        } else {
          button.textContent = 'Select Size & Flavor';
          button.disabled = true;
        }
      }

      function changeQuantity(delta) {
        const input = document.getElementById('quantity');
        const next = Math.max(1, Math.min(50, (parseInt(input.value, 10) || 1) + delta));
        input.value = next;
        updateUI();
      }

      async function updateCartCount() {
        try {
          const res = await fetch('/cart.js', { credentials: 'same-origin' });
          if (res.ok) {
            const cart = await res.json();
            const countEl = document.getElementById('cart-count');
            countEl.textContent = cart.item_count || 0;
            countEl.parentElement.setAttribute('aria-live', 'polite');
          }
        } catch (e) {}
      }

      function validateSelections() {
        if (!selectedSize) {
          alert('❗ Please choose a size.');
          return false;
        }
        if (!selectedFlavor) {
          alert('❗ Please choose a flavor.');
          return false;
        }
        if (selectedSize === 'Gallon' && !selectedConcentration) {
          alert('❗ Please choose a THC concentration for gallon size.');
          return false;
        }
        return true;
      }

      async function addToCart() {
        if (!validateSelections()) return;

        const btn = document.getElementById('add-to-cart-btn');
        const original = btn.textContent;
        btn.textContent = '⏳ Adding...';
        btn.disabled = true;

        const variantId = window.THC_DRINKS_VARIANT_ID;
        const quantity = Math.max(1, Math.min(50, parseInt(document.getElementById('quantity').value || '1', 10)));
        const comments = (document.getElementById('order-comments').value || '').trim();

        const properties = { 
          Size: selectedSize,
          Flavor: selectedFlavor,
          Ice: selectedIce,
          'Product Type': 'THC Drinks'
        };
        if (selectedConcentration) properties['THC Concentration'] = selectedConcentration;
        if (comments) properties.Comments = comments;

        try {
          if (variantId) {
            const body = new URLSearchParams();
            body.set('id', String(variantId));
            body.set('quantity', String(quantity));
            for (const k in properties) body.set(`properties[${k}]`, String(properties[k]));

            const res = await fetch('/cart/add.js', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                Accept: 'application/json',
              },
              credentials: 'same-origin',
              body,
            });

            if (!res.ok) {
              let msg = 'Add to cart failed';
              try {
                const data = await res.json();
                msg = data.description || data.message || msg;
              } catch {}
              throw new Error(msg);
            }
          } else {
            // Fallback: store cart locally for dev/preview modes
            const order = {
              id: 'thc-drinks-' + Date.now() + '-' + Math.random().toString(36).slice(2),
              product: 'THC Drinks',
              ...properties,
              quantity,
              price: (basePrice * quantity).toFixed(2),
              timestamp: new Date().toISOString(),
            };
            let cart = [];
            try {
              cart = JSON.parse(localStorage.getItem('wtf-cart') || '[]');
            } catch {}
            cart.push(order);
            localStorage.setItem('wtf-cart', JSON.stringify(cart));
          }

          await updateCartCount();

          const success = document.getElementById('success-message');
          success.innerHTML = `✅ <strong>Added to cart!</strong><br>
             🍹 THC Drinks — <strong>${properties.Size}</strong><br>
             🍓 Flavor: ${properties.Flavor}<br>
             🧊 Ice: ${properties.Ice}<br>
             🔢 Qty: ${quantity}${properties.Comments ? `<br>💬 ${properties.Comments}` : ''}`;
          success.classList.add('show');
          success.scrollIntoView({ behavior: 'smooth', block: 'center' });

          document.dispatchEvent(new CustomEvent('thc-drinks:added', { detail: { variantId, ...properties, quantity } }));
        } catch (err) {
          console.error('Add to cart error:', err);
          alert('❌ ' + (err && err.message ? err.message : 'Error adding to cart. Please try again.'));
        } finally {
          setTimeout(() => {
            btn.textContent = original;
            btn.disabled = false;
            document.getElementById('success-message').classList.remove('show');
          }, 4000);
        }
      }
    </script>
  </body>
</html>
