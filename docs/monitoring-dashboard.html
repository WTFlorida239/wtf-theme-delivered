<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WTF Monitoring Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2rem;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            margin-top: 0.5rem;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #e1e5e9;
        }
        
        .card h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-weight: 500;
            color: #555;
        }
        
        .metric-value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .status-good { color: #27ae60; }
        .status-warning { color: #f39c12; }
        .status-error { color: #e74c3c; }
        .status-critical { color: #c0392b; }
        
        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .alert.error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .alert.critical {
            background: #f8d7da;
            border-color: #f5c6cb;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .chart-container {
            height: 200px;
            margin-top: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.danger {
            background: #dc3545;
        }
        
        .timestamp {
            font-size: 0.875rem;
            color: #666;
            text-align: center;
            margin-top: 2rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .grid-2 {
            grid-column: span 2;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
                padding: 0 1rem;
            }
            
            .grid-2 {
                grid-column: span 1;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç WTF Monitoring Dashboard</h1>
        <p>Real-time monitoring for WTF | Welcome To Florida</p>
    </div>

    <div class="dashboard">
        <div class="controls grid-2">
            <button class="btn" onclick="refreshDashboard()">
                <span id="refresh-icon">üîÑ</span> Refresh Data
            </button>
            <button class="btn secondary" onclick="exportMetrics()">
                üìä Export Metrics
            </button>
            <button class="btn secondary" onclick="clearAlerts()">
                üóëÔ∏è Clear Alerts
            </button>
            <button class="btn danger" onclick="toggleMonitoring()">
                <span id="monitoring-status">‚èπÔ∏è Stop Monitoring</span>
            </button>
        </div>

        <!-- System Status -->
        <div class="card">
            <h2>üö¶ System Status</h2>
            <div class="metric">
                <span class="metric-label">Overall Status</span>
                <span class="metric-value status-good" id="overall-status">Operational</span>
            </div>
            <div class="metric">
                <span class="metric-label">Monitoring Active</span>
                <span class="metric-value status-good" id="monitoring-active">Yes</span>
            </div>
            <div class="metric">
                <span class="metric-label">Last Update</span>
                <span class="metric-value" id="last-update">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Environment</span>
                <span class="metric-value" id="environment">--</span>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="card">
            <h2>‚ö° Performance</h2>
            <div class="metric">
                <span class="metric-label">Page Load Time</span>
                <span class="metric-value" id="load-time">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Largest Contentful Paint</span>
                <span class="metric-value" id="lcp">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">First Input Delay</span>
                <span class="metric-value" id="fid">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Cumulative Layout Shift</span>
                <span class="metric-value" id="cls">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">JavaScript Errors</span>
                <span class="metric-value" id="js-errors">--</span>
            </div>
        </div>

        <!-- Business Metrics -->
        <div class="card">
            <h2>üíº Business</h2>
            <div class="metric">
                <span class="metric-label">Conversion Rate</span>
                <span class="metric-value" id="conversion-rate">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Cart Value</span>
                <span class="metric-value" id="cart-value">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Session Duration</span>
                <span class="metric-value" id="session-duration">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Drink Builder Completions</span>
                <span class="metric-value" id="builder-completions">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Cart Abandonment Rate</span>
                <span class="metric-value" id="cart-abandonment">--</span>
            </div>
        </div>

        <!-- Inventory Status -->
        <div class="card">
            <h2>üì¶ Inventory</h2>
            <div class="metric">
                <span class="metric-label">Low Stock Items</span>
                <span class="metric-value" id="low-stock">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Out of Stock</span>
                <span class="metric-value" id="out-of-stock">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Total Products</span>
                <span class="metric-value" id="total-products">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Average Stock Level</span>
                <span class="metric-value" id="avg-stock">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Critical Items</span>
                <span class="metric-value" id="critical-items">--</span>
            </div>
        </div>

        <!-- Analytics -->
        <div class="card">
            <h2>üìà Analytics</h2>
            <div class="metric">
                <span class="metric-label">Bounce Rate</span>
                <span class="metric-value" id="bounce-rate">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Mobile Traffic</span>
                <span class="metric-value" id="mobile-traffic">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Local Traffic</span>
                <span class="metric-value" id="local-traffic">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Pages per Session</span>
                <span class="metric-value" id="pages-per-session">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Goal Completions</span>
                <span class="metric-value" id="goal-completions">--</span>
            </div>
        </div>

        <!-- Alerts -->
        <div class="card grid-2">
            <h2>üö® Active Alerts</h2>
            <div id="alerts-container">
                <p style="color: #666; text-align: center; padding: 2rem;">No active alerts</p>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="card grid-2">
            <h2>üìä Performance Trends</h2>
            <div class="chart-container">
                <p>Performance chart will be displayed here<br>
                <small>(Integration with Chart.js or similar library)</small></p>
            </div>
        </div>
    </div>

    <div class="timestamp">
        Last updated: <span id="dashboard-timestamp">--</span>
    </div>

    <script>
        // Dashboard JavaScript
        let monitoringActive = true;
        let refreshInterval;

        function initializeDashboard() {
            console.log('üîç Initializing WTF Monitoring Dashboard...');
            
            // Set environment
            document.getElementById('environment').textContent = window.location.hostname;
            
            // Start auto-refresh
            startAutoRefresh();
            
            // Initial data load
            refreshDashboard();
        }

        function startAutoRefresh() {
            refreshInterval = setInterval(refreshDashboard, 30000); // 30 seconds
        }

        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        }

        async function refreshDashboard() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.innerHTML = '<div class="loading"></div>';
            
            try {
                // Get metrics from monitoring system
                const metrics = window.WTFMonitoring ? window.WTFMonitoring.getMetrics() : null;
                
                if (metrics) {
                    updatePerformanceMetrics(metrics.performance);
                    updateBusinessMetrics(metrics.business);
                    updateInventoryMetrics(metrics.inventory);
                    updateAnalyticsMetrics(metrics.analytics);
                    updateAlerts(metrics.alerts);
                    updateSystemStatus(metrics);
                } else {
                    // Simulate data for demo
                    updateWithDemoData();
                }
                
                // Update timestamp
                document.getElementById('dashboard-timestamp').textContent = new Date().toLocaleString();
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                
            } catch (error) {
                console.error('Dashboard refresh error:', error);
                showError('Failed to refresh dashboard data');
            } finally {
                refreshIcon.textContent = 'üîÑ';
            }
        }

        function updatePerformanceMetrics(performance) {
            if (!performance) return;
            
            document.getElementById('load-time').textContent = 
                performance.loadTime ? `${(performance.loadTime / 1000).toFixed(2)}s` : '--';
            document.getElementById('lcp').textContent = 
                performance.lcp ? `${(performance.lcp / 1000).toFixed(2)}s` : '--';
            document.getElementById('fid').textContent = 
                performance.fid ? `${performance.fid.toFixed(2)}ms` : '--';
            document.getElementById('cls').textContent = 
                performance.cls ? performance.cls.toFixed(3) : '--';
            document.getElementById('js-errors').textContent = 
                performance.jsErrors ? performance.jsErrors.length : '0';
            
            // Update status colors
            updateMetricStatus('load-time', performance.loadTime, 3000);
            updateMetricStatus('lcp', performance.lcp, 2500);
            updateMetricStatus('cls', performance.cls, 0.1, true);
            updateMetricStatus('js-errors', performance.jsErrors?.length || 0, 0);
        }

        function updateBusinessMetrics(business) {
            if (!business) return;
            
            document.getElementById('conversion-rate').textContent = 
                business.conversionRate ? `${business.conversionRate.toFixed(2)}%` : '--';
            document.getElementById('cart-value').textContent = 
                business.cartValue ? `$${business.cartValue.toFixed(2)}` : '--';
            document.getElementById('session-duration').textContent = 
                business.sessionDuration ? formatDuration(business.sessionDuration) : '--';
            document.getElementById('builder-completions').textContent = 
                business.drinkBuilderCompletions || '0';
            document.getElementById('cart-abandonment').textContent = 
                business.cartAbandonmentRate ? `${business.cartAbandonmentRate.toFixed(2)}%` : '--';
        }

        function updateInventoryMetrics(inventory) {
            if (!inventory) return;
            
            document.getElementById('low-stock').textContent = 
                inventory.lowStockItems ? inventory.lowStockItems.length : '0';
            document.getElementById('out-of-stock').textContent = 
                inventory.outOfStockItems ? inventory.outOfStockItems.length : '0';
            document.getElementById('total-products').textContent = 
                inventory.totalProducts || '0';
            document.getElementById('avg-stock').textContent = 
                inventory.averageStockLevel ? inventory.averageStockLevel.toFixed(0) : '--';
            document.getElementById('critical-items').textContent = 
                inventory.criticalLowStock ? inventory.criticalLowStock.length : '0';
            
            // Update status colors
            updateMetricStatus('low-stock', inventory.lowStockItems?.length || 0, 5);
            updateMetricStatus('out-of-stock', inventory.outOfStockItems?.length || 0, 0);
            updateMetricStatus('critical-items', inventory.criticalLowStock?.length || 0, 0);
        }

        function updateAnalyticsMetrics(analytics) {
            if (!analytics) return;
            
            document.getElementById('bounce-rate').textContent = 
                analytics.bounceRate ? `${analytics.bounceRate.toFixed(1)}%` : '--';
            document.getElementById('mobile-traffic').textContent = 
                analytics.mobileTraffic ? `${analytics.mobileTraffic.toFixed(1)}%` : '--';
            document.getElementById('local-traffic').textContent = 
                analytics.localTraffic ? `${analytics.localTraffic.toFixed(1)}%` : '--';
            document.getElementById('pages-per-session').textContent = 
                analytics.pagesPerSession ? analytics.pagesPerSession.toFixed(1) : '--';
            document.getElementById('goal-completions').textContent = 
                analytics.goalCompletions || '0';
        }

        function updateAlerts(alerts) {
            const container = document.getElementById('alerts-container');
            
            if (!alerts || alerts.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 2rem;">No active alerts</p>';
                return;
            }
            
            container.innerHTML = alerts.slice(-10).map(alert => `
                <div class="alert ${alert.type}">
                    <strong>${alert.type.toUpperCase()}:</strong> ${alert.message}
                    <br><small>${new Date(alert.timestamp).toLocaleString()}</small>
                </div>
            `).join('');
        }

        function updateSystemStatus(metrics) {
            const hasErrors = metrics.alerts?.some(alert => alert.type === 'error' || alert.type === 'critical');
            const hasWarnings = metrics.alerts?.some(alert => alert.type === 'warning');
            
            const statusElement = document.getElementById('overall-status');
            if (hasErrors) {
                statusElement.textContent = 'Issues Detected';
                statusElement.className = 'metric-value status-error';
            } else if (hasWarnings) {
                statusElement.textContent = 'Warnings';
                statusElement.className = 'metric-value status-warning';
            } else {
                statusElement.textContent = 'Operational';
                statusElement.className = 'metric-value status-good';
            }
        }

        function updateMetricStatus(elementId, value, threshold, inverse = false) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const isGood = inverse ? value <= threshold : value < threshold;
            const isCritical = inverse ? value > threshold * 2 : value > threshold * 1.5;
            
            element.className = element.className.replace(/status-\w+/g, '');
            if (isCritical) {
                element.classList.add('status-critical');
            } else if (!isGood) {
                element.classList.add('status-warning');
            } else {
                element.classList.add('status-good');
            }
        }

        function updateWithDemoData() {
            // Demo data for when monitoring system isn't available
            const demoData = {
                performance: {
                    loadTime: 2100,
                    lcp: 1800,
                    fid: 45,
                    cls: 0.05,
                    jsErrors: []
                },
                business: {
                    conversionRate: 3.2,
                    cartValue: 28.50,
                    sessionDuration: 180000,
                    drinkBuilderCompletions: 15,
                    cartAbandonmentRate: 65.2
                },
                inventory: {
                    lowStockItems: [1, 2],
                    outOfStockItems: [],
                    totalProducts: 45,
                    averageStockLevel: 23,
                    criticalLowStock: [1]
                },
                analytics: {
                    bounceRate: 42.3,
                    mobileTraffic: 68.5,
                    localTraffic: 34.2,
                    pagesPerSession: 2.8,
                    goalCompletions: 8
                },
                alerts: []
            };
            
            updatePerformanceMetrics(demoData.performance);
            updateBusinessMetrics(demoData.business);
            updateInventoryMetrics(demoData.inventory);
            updateAnalyticsMetrics(demoData.analytics);
            updateAlerts(demoData.alerts);
            updateSystemStatus(demoData);
        }

        function formatDuration(ms) {
            const minutes = Math.floor(ms / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            return `${minutes}m ${seconds}s`;
        }

        function exportMetrics() {
            if (window.WTFMonitoring) {
                window.WTFMonitoring.exportMetrics();
            } else {
                alert('Monitoring system not available');
            }
        }

        function clearAlerts() {
            if (window.WTFMonitoring) {
                window.WTFMonitoring.clearAlerts();
                refreshDashboard();
            } else {
                document.getElementById('alerts-container').innerHTML = 
                    '<p style="color: #666; text-align: center; padding: 2rem;">No active alerts</p>';
            }
        }

        function toggleMonitoring() {
            const statusElement = document.getElementById('monitoring-status');
            const activeElement = document.getElementById('monitoring-active');
            
            if (monitoringActive) {
                if (window.WTFMonitoring) {
                    window.WTFMonitoring.stopMonitoring();
                }
                stopAutoRefresh();
                statusElement.textContent = '‚ñ∂Ô∏è Start Monitoring';
                activeElement.textContent = 'No';
                activeElement.className = 'metric-value status-error';
                monitoringActive = false;
            } else {
                if (window.WTFMonitoring) {
                    window.WTFMonitoring.startMonitoring();
                }
                startAutoRefresh();
                statusElement.textContent = '‚èπÔ∏è Stop Monitoring';
                activeElement.textContent = 'Yes';
                activeElement.className = 'metric-value status-good';
                monitoringActive = true;
            }
        }

        function showError(message) {
            const container = document.getElementById('alerts-container');
            container.innerHTML = `
                <div class="alert error">
                    <strong>ERROR:</strong> ${message}
                    <br><small>${new Date().toLocaleString()}</small>
                </div>
            `;
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
        
        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else if (monitoringActive) {
                startAutoRefresh();
                refreshDashboard();
            }
        });
    </script>
</body>
</html>
